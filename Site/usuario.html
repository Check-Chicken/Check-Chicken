<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="style-usuario.css">
    <link rel="shortcut icon" href="images/logo_galinha.png">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <nav>
        <div class="navbar">
            <div class="container nav-container">
                <input class="checkbox" type="checkbox" name="" id="" />
                <div class="hamburger-lines">
                    <span class="line line1"></span>
                    <span class="line line2"></span>
                    <span class="line line3"></span>
                </div>
                <div class="area_icone_tema">
                    <div class="icone_tema">

                        <button id="trocaCor" onclick="changeColor()"><img src="images/dia-e-noite.png" alt=""></button>

                    </div>
                </div>
                <div class="menu-items">
                    <div class="logo">
                        <img src="images/logo_novo.png">
                    </div>
                    <div class="foto-usuario">
                        <img src="images/mulher.png">
                        <p style="margin-left: 2vw;">Olá, Fernanda!</p>
                        <div class="dropdown">
                            <span onclick="myFunction()" class="dropbtn"> &#129123;</span>
                            <div id="myDropdown" class="dropdown-content fade">
                                <a href="#">Editar Empresa</a>
                                <a href="#">Editar Perfil</a>
                                <a href="#">Cadastrar Funcionário</a>
                                <div>
                                    <a href="inicio.html">
                                        <button class="Btn">
                                            <div class="sign">
                                                <svg viewBox="0 0 512 512">
                                                    <path
                                                        d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z">
                                                    </path>
                                                </svg>
                                            </div>
                                            <div class="text">Sair</div>
                                        </button>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <li><img class="navIcon" src="images/Dash.png"><a href="#">Dashboard</a></li>
                    <li><img class="navIcon" src="images/Notification.png"><a href="#">Notificações</a></li>
                    <li><img class="navIcon" src="images/Config.png"><a href="#">Definições</a></li>
                </div>
            </div>
        </div>
    </nav>

    <!-- Corpo da página -->
    <div class="corpo" id="corpo">
        <!-- corpo que envolve as kpis e os graficos -->
        <div class="corpo-principal">
            <!-- KPIs -->

            <div class="legenda"><img src="images/legenda.png" alt=""></div>
            <p id="titulo_kpi" class="titulo_kpi">Indicadores de performance dos últimos 30 dias</p>
            <div class="corpo-kpi">
                <div class="kpi">Lotes que apresentaram problema
                    <div class="info-kpi1">50%</div>
                </div>
                <div class="kpi">Lotes que apresentaram temperatura fora do padrão
                    <div class="info-kpi2">1</div>
                </div>
                <div class="kpi">Lotes que apresentaram umidade fora do padrão
                    <div class="info-kpi3">0</div>
                </div>
            </div>
            <!-- Área de Gráficos -->
            <div class="area-graficos">

                <div class="grafico grafico1">
                    <div class="maine3">
                        <p style="font-size: 18px;">Dados de temperatura: Lote 1</p>
                        <div class="table1">
                            <section style="width: 70%; height: 50vh;">
                                <canvas id="lm35Temperatura"></canvas>
                            </section>
                        </div>
                    </div>
                </div>
                <div class="grafico grafico2">
                    <div class="maine4">
                        <p style="font-size: 18px;">Dados de umidade: Lote 1</p>
                        <div class="table2">
                            <section style="width: 70%; height: 50vh;">
                                <canvas id="dht11Umidade"></canvas>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Lotes -->
        <div class="corpo-lotes">
            <!-- Lote 1 -->
            <div class="lote" id="lote1">
                <div class="titulo-lote">Lote 1</div>
                <div class="corpo-lote">
                    <div class="caixa-lote">
                        <div class="conteudo-lote1">Temp. Atual
                            <div class="caixa-temp">0º</div>
                        </div>
                    </div>
                    <div class="caixa2-lote">
                        <div class="conteudo-lote1">Umid. Atual
                            <div class="caixa-umid">0%</div>
                        </div>
                    </div>
                </div>
                <select name="historico" id="historico">
                    <option value="#" disabled selected>Histórico de Registro</option>
                    <option value="">05/04/2024</option>
                    <option value="">06/04/2024</option>
                    <option value="">07/04/2024</option>
                    <option value="">08/04/2024</option>
                    <option value="">09/04/2024</option>
                    <option value="">10/04/2024</option>
                </select>
            </div>

            <!-- Lote 2 -->
            <div class="lote" id="lote2">
                <div class="titulo-lote">Lote 2</div>
                <div class="corpo-lote">
                    <div class="caixa-lote">
                        <div class="conteudo-lote2">Temp. Atual
                            <div class="caixa-temp2">24º</div>
                        </div>
                    </div>
                    <div class="caixa2-lote">
                        <div class="conteudo-lote2">Umid. Atual
                            <div class="caixa-umid2">80</div>
                        </div>
                    </div>
                </div>
                <select name="historico" id="historico">
                    <option value="#" disabled selected>Histórico de Registro</option>
                    <option value="">05/04/2024</option>
                    <option value="">06/04/2024</option>
                    <option value="">07/04/2024</option>
                    <option value="">08/04/2024</option>
                    <option value="">09/04/2024</option>
                    <option value="">10/04/2024</option>
                </select>
            </div>
            <div class="botao-area">
                <button id="botao_lote" class="botao_lote">+</button>
                <p id="texto_botaoLote" class="texto_botaoLote">Adicionar Lote</p>
            </div>
        </div>

    </div>






</body>
<!-- footer -->
<footer>
    <div class="footer">
        <div class="infos footerText">
            <a href="inicio.html"><img src="images/logo_galinha.png" style="width: 2.5vw; margin-right: 2vw;"></a>
            <img src="images/facebook.png" style="width: 2vw;">
            <img src="images/instagram.png" style="width: 1.5vw; margin-left: 0.5vw; margin-right: 1vw;">
            <p style="font-size: 50px; margin-right: 2vw; font-weight: lighter;color: #F5F4F9;">|</p>
            <div class="endereco">
                <u>Rua Haddock Lobo, 595 São Paulo - SP</u>
            </div>

            <p style="font-size: 50px; margin-left: 2vw; font-weight: lighter; color: #F5F4F9;">|</p>

            <div class="contato">

                <a href="usuario.html" style="font-size: 16px; color: #F5F4F9;">www.checkchicken.com.br</a>
                <p style="font-size: 16px; color: #F5F4F9;">(11) 2536-6498</p>
                <p style="font-size: 12px; color:#d0ad00;">© 2024 by CheckChicken</p>

            </div>

            <p style="font-size: 50px; margin-right: 1vw; font-weight: lighter; color: #F5F4F9;">|</p>
            <div class="pages">

                <li>Política e privacidade</li> |

                <li>Termos de uso</li> |
                <li>Info</li> |
                <li>Suporte</li>
            </div>
        </div>

    </div>
</footer>

</html>

<script>

    //funcao para trocar cor do fundo
    const colorDiv = document.getElementById('corpo');
    const colorP = document.getElementById('titulo_kpi');
    const colorBotao = document.getElementById('texto_botaoLote');
    const colorButton = document.getElementById('trocaCor');

    function changeColor() {
        const hasSecondColor = colorDiv.classList.contains('second');
        const hasSecondColor2 = colorP.classList.contains('second2');
        const hasSecondColor3 = colorBotao.classList.contains('second3');

        if (hasSecondColor && hasSecondColor2 && hasSecondColor2) {
            colorDiv.classList.remove('second')
            colorP.classList.remove('second2')
            colorBotao.classList.remove('second3')
        } else {
            colorDiv.classList.add('second')
            colorP.classList.add('second2')
            colorBotao.classList.add('second3')
        }
    }


    // funcao para o dropdown
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }

    // graficos
    var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
    contextoDht11Umidade.canvas.width = 500;
    contextoDht11Umidade.canvas.height = 250;

    var dht11Umidade = new Chart(
        contextoDht11Umidade,
        {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Umidade',
                    type: 'line',
                    borderColor: ['#45b3e7'],
                    backgroundColor: ['#89cff0']
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        distribution: 'series',
                        ticks: {
                            beginAtZero: true,

                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Umidade',
                            min: 0,
                            max: 100,
                            stepSize: 5
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                animation: {
                    duration: 0
                }
            }
        }
    );
    /* -- lm35Temperatura */
    var contextoLm35Temperatura = document.getElementById('lm35Temperatura').getContext('2d');
    contextoLm35Temperatura.canvas.width = 500;
    contextoLm35Temperatura.canvas.height = 250;
    var lm35Temperatura = new Chart(
        contextoLm35Temperatura,
        {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Temperatura',
                    type: 'line',
                    borderColor: ['#ffd902'],
                    backgroundColor: ['#ffe135']
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        distribution: 'series',
                        ticks: {
                            beginAtZero: true,

                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Temperatura'
                        },
                        ticks: {
                            beginAtZero: true,
                            min: 0,
                            max: 50,
                            stepSize: 5
                        }
                    }]
                },
                animation: {
                    duration: 0.5
                }
            }
        }
    )
    var paginacao = {};
    var tempo = {};
   // Função para obter dados dos sensores
function obterDados(grafico, endpoint, caixa) {
    var http = new XMLHttpRequest();
    http.open('GET', 'http://localhost:3300/sensores/' + endpoint, false);
    http.send(null);
    var valores = JSON.parse(http.responseText);

    // Atualizar o texto correspondente (umidade ou temperatura)
    caixa.textContent = valores[valores.length - 1];

    // Exibir à partir do último elemento exibido anteriormente
    var ultimaPaginacao = paginacao[endpoint] || 0;
    paginacao[endpoint] = valores.length;
    var valores = valores.slice(ultimaPaginacao);
    valores.forEach((valor) => {
        // Atualizar o gráfico
        if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
            grafico.data.labels.shift();
            grafico.data.datasets[0].data.shift();
        }

        grafico.data.labels.push(tempo[endpoint]++);
        grafico.data.datasets[0].data.push(parseFloat(valor));
        grafico.update();
    });
}

    setInterval(() => {
        obterDados(dht11Umidade, 'dht11/umidade');
        obterDados(lm35Temperatura, 'lm35/temperatura');
    }, 2000);


   // Guardar uma referência para o elemento HTML que contém o texto da umidade
var caixaUmidade = document.querySelector('.caixa-umid');
var caixaTemperatura = document.querySelector('.caixa-temp');
// Função para atualizar a umidade exibida
function atualizarUmidade(umidade) {
    caixaUmidade.textContent = 
     umidade.toFixed(2) + '%'; // Arredonda para duas casas decimais
}
function atualizarTemp(temperatura) {
    caixaTemperatura.textContent = 
     temperatura.toFixed(2) + 'º'; // Arredonda para duas casas decimais
}

// Função para obter dados simulados para os gráficos
function gerarDadosSimulados() {
    var valorMedioTemp = 35;
    var amplitudeTemp = 7;

    var valorMedioUmid = 65;
    var amplitudeUmid = 15;

    // Gerar valores aleatórios para temperatura e umidade
    var umidade = valorMedioUmid + (Math.random() * (amplitudeUmid * 2) - amplitudeUmid);
    var temperatura = valorMedioTemp + (Math.random() * (amplitudeTemp * 2) - amplitudeTemp);

    // Chamar as funções para atualizar os gráficos e as caixas de temperatura e umidade com os dados gerados
    atualizarGraficos(umidade, temperatura);
    atualizarUmidade(umidade);
    atualizarTemp(temperatura);
    alterarCorTemp(temperatura, document.querySelector('.caixa-temp'));
    alterarCorUmid(umidade, document.querySelector('.caixa-umid'));
}



// Função para atualizar os gráficos com os dados gerados
function atualizarGraficos(umidade, temperatura) {
    // Máximo de 10 itens exibidos no gráfico
    if (dht11Umidade.data.labels.length == 800 && dht11Umidade.data.datasets[0].data.length == 800) {
        dht11Umidade.data.labels.shift();
        dht11Umidade.data.datasets[0].data.shift();
    }

    // Adicionar os valores gerados ao gráfico de umidade
    dht11Umidade.data.labels.push(dht11Umidade.data.labels.length + 1);
    dht11Umidade.data.datasets[0].data.push(parseFloat(umidade.toFixed()));

    // Máximo de 10 itens exibidos no gráfico
    if (lm35Temperatura.data.labels.length == 100 && lm35Temperatura.data.datasets[0].data.length == 100) {
        lm35Temperatura.data.labels.shift();
        lm35Temperatura.data.datasets[0].data.shift();
    }

    // Adicionar os valores gerados ao gráfico de temperatura
    lm35Temperatura.data.labels.push(lm35Temperatura.data.labels.length + 1);
    lm35Temperatura.data.datasets[0].data.push(parseFloat(temperatura.toFixed()));

    // Atualizar os gráficos
    dht11Umidade.update();
    lm35Temperatura.update();
}


// Intervalo para gerar dados simulados a cada 5 segundos
setInterval(() => {
    // Chamar a função para gerar dados simulados
    gerarDadosSimulados();
    
    // Incrementar o tempo
    tempo++;
}, 5000);


// funcao para alterar a cor da caixa dependendo do valor capturado
function alterarCorTemp(valor, caixa) {
    // Seleciona a caixa pela classe e define a cor com base no valor 
    if (valor > 35) {
        caixa.style.backgroundColor = '#FF5151';
    } else if (valor >= 31 && valor <=35) {
        caixa.style.backgroundColor = '#4BB262';
    } else if (valor == 30 || valor == 36) {
        caixa.style.backgroundColor = '#F5B91E';
    }else{
        caixa.style.backgroundColor = '#4BAFE8';
    }
}
function alterarCorUmid(valor, caixa) {
    // Seleciona a caixa pela classe e define a cor com base no valor
    if (valor > 70) {
        caixa.style.backgroundColor = '#FF5151';
    } else if (valor >= 60 && valor <=70) {
        caixa.style.backgroundColor = '#4BB262';
    } else if ((valor >= 55 && valor<=59) || (valor <= 75 && valor>=71)) {
        caixa.style.backgroundColor = '#F5B91E';
    }else{
        caixa.style.backgroundColor = '#4BAFE8';
    }
}



</script>